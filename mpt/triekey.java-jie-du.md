# TrieKey.java解读

MPT树中的叶子节点和扩展节点都包含节点Key。在构建MPT树时，以半字节(nibble，4个bit)为单位查找多个Key的公共前缀和创建节点。为了方便对半字节的处理，及对节点类型的区分，以太坊黄皮书中设计了一种专门用于MPT树的HP（Hex-Prefix，十六进制前缀）编码，编码后的内容包含2部分：

l 前缀部分

前缀是半个字节，取值范围是0-3（含义如下表）

| <p><strong>半字节数量</strong></p><p><strong>节点类型</strong></p> | **奇数(1)**                             | **偶数(0)**                             |
| --------------------------------------------------------- | ------------------------------------- | ------------------------------------- |
| **叶子节点(2)**                                               | <p><strong>3</strong></p><p>(2+1)</p> | <p><strong>2</strong></p><p>(2+0)</p> |
| **非叶子节点(0)**                                              | <p><strong>1</strong></p><p>(0+1)</p> | <p><strong>0</strong></p><p>(0+0)</p> |

&#x20;

l 原文部分

原文包含N（整数）个半字节，HP编码对原文半字节个数的奇偶性是敏感的，对应2种不同的编码格式：

| **原文的半字节个数** | **HP编码字节数组**                                 |
| ------------ | -------------------------------------------- |
| 偶数           | \[ 前缀半字节（高位）,  (原文半字节 + 原文半字节),  ... ]       |
| 奇数           | \[ (前缀半字节 + 原文半字节),  (原文半字节 + 原文半字节),  ... ] |


